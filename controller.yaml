# 5 Kubernetes objects
# Deployment/workshop-demo
# PersistentVolumeClaim/jenkins-home-workshop-demo-0
# Service/workshop-demo
# Ingress/workshop-demo
# PodDisruptionBudget/workshop-demo
---
statefulset: null
deployment:
  apiVersion: "apps/v1"
  kind: "Deployment"
  metadata:
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    replicas: 2
    revisionHistoryLimit: 0
    selector:
      matchLabels:
        com.cloudbees.cje.tenant: "workshop-demo"
        com.cloudbees.cje.type: "master"
        com.cloudbees.pse.tenant: "workshop-demo"
        com.cloudbees.pse.type: "master"
        tenant: "workshop-demo"
        type: "master"
    template:
      metadata:
        labels:
          com.cloudbees.cje.tenant: "workshop-demo"
          com.cloudbees.cje.type: "master"
          com.cloudbees.pse.tenant: "workshop-demo"
          com.cloudbees.pse.type: "master"
          tenant: "workshop-demo"
          type: "master"
        name: "workshop-demo"
        namespace: "cloudbees-sda"
      spec:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: "kubernetes.io/os"
                  operator: "In"
                  values:
                  - "linux"
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.type"
                    operator: "In"
                    values:
                    - "cjoc"
                topologyKey: "kubernetes.io/hostname"
              weight: 1
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "jenkins"
                    operator: "In"
                    values:
                    - "slave"
                topologyKey: "kubernetes.io/hostname"
              weight: 1
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.tenant"
                    operator: "In"
                    values:
                    - "workshop-demo"
                topologyKey: "kubernetes.io/hostname"
              weight: 10
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.tenant"
                    operator: "In"
                    values:
                    - "workshop-demo"
                topologyKey: "topology.kubernetes.io/zone"
              weight: 10
        containers:
        - env:
          - name: "ENVIRONMENT"
            value: "KUBERNETES"
          - name: "JAVA_OPTS"
            value: "-Djenkins.model.Jenkins.slaveAgentPort=\"50000\" -Dhudson.TcpSlaveAgentListener.port=\"\
              50023\" -DexecutableWar.jetty.disableCustomSessionIdCookieName=\"true\"\
              \ -Dhudson.lifecycle=\"com.cloudbees.jenkins.plugins.replication.oc.RolloutLifecycle\"\
              \ -DMASTER_NAME=\"workshop-demo\" -Djenkins.model.Jenkins.slaveAgentPortEnforce=\"\
              true\" -DMASTER_GRANT_ID=\"2f3ca34a-abd8-4cba-a3e8-363a6b1aae86\" -Dhazelcast.config=\"\
              /usr/share/hazelcast/member.xml\" -DMASTER_DOMAIN=\"workshop-demo\" -Dcb.IMProp.warProfiles=\"\
              replication.json\" -DMASTER_INDEX=\"22\" -DMASTER_OPERATIONSCENTER_ENDPOINT=\"\
              http://cjoc.cloudbees-sda.svc.cluster.local/cjoc/\" -Dcom.cloudbees.jenkins.replication.warhead.ReplicationServletListener.enabled=\"\
              true\" -DMASTER_ENDPOINT=\"https://sda.preview.cb-demos.io/workshop-demo/\"\
              \ -DMASTER_WEBSOCKET=\"true\" -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=\"\
              true\" --add-modules java.se --add-exports java.base/jdk.internal.ref=ALL-UNNAMED\
              \ --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/sun.nio.ch=ALL-UNNAMED\
              \ --add-opens java.management/sun.management=ALL-UNNAMED --add-opens\
              \ jdk.management/com.sun.management.internal=ALL-UNNAMED -DMASTER_RESOURCE_URL=\
              \ -XshowSettings:vm -XX:+AlwaysPreTouch -XX:+DisableExplicitGC -XX:+ParallelRefProcEnabled\
              \ -XX:+UseStringDeduplication -Dhudson.slaves.NodeProvisioner.initialDelay=0\
              \ -Dorg.csanchez.jenkins.plugins.kubernetes.pipeline.PodTemplateStepExecution.defaultImage=cloudbees/cloudbees-core-agent:2.440.2.1\
              \ -Dcom.cloudbees.jenkins.plugins.kube.ServiceAccountFilter.defaultServiceAccount=jenkins-agents\
              \ -Dcom.cloudbees.networking.useSubdomain=false -Dcom.cloudbees.networking.protocol=\"\
              https\" -Dcom.cloudbees.networking.hostname=\"sda.preview.cb-demos.io\"\
              \ -Dcom.cloudbees.networking.port=443 -Dcom.cloudbees.networking.operationsCenterName=\"\
              cjoc\" -Dcom.sun.management.jmxremote.port=1099 -Dcom.sun.management.jmxremote.authenticate=false\
              \ -Dcom.sun.management.jmxremote.ssl=false"
          - name: "JENKINS_OPTS"
            value: "--prefix=/workshop-demo/"
          - name: "KUBERNETES_JENKINS_URL"
            value: "http://workshop-demo.cloudbees-sda.svc.cluster.local/workshop-demo/"
          image: "cloudbees/cloudbees-core-mm:2.440.3.8"
          livenessProbe:
            httpGet:
              path: "/workshop-demo/whoAmI/api/json?tree=authenticated"
              port: 8080
            initialDelaySeconds: 300
            periodSeconds: 10
            timeoutSeconds: 10
          name: "jenkins"
          ports:
          - containerPort: 8080
            name: "http"
          - containerPort: 50000
            name: "jnlp"
          - containerPort: 5701
            name: "hazelcast"
          readinessProbe:
            failureThreshold: 100
            httpGet:
              path: "/workshop-demo/whoAmI/api/json?tree=authenticated"
              port: 8080
            initialDelaySeconds: 30
            timeoutSeconds: 5
          resources:
            limits:
              cpu: "1.000000"
              memory: "3072.000000M"
          volumeMounts:
          - mountPath: "/tmp"
            name: "tmp"
          - mountPath: "/var/jenkins_home"
            name: "jenkins-home"
        enableServiceLinks: false
        securityContext:
          fsGroup: 1000
        serviceAccountName: "jenkins"
        terminationGracePeriodSeconds: 1200
        volumes:
        - emptyDir: {}
          name: "tmp"
        - name: "jenkins-home"
          persistentVolumeClaim:
            claimName: "jenkins-home-workshop-demo-0"
pvc:
  apiVersion: "v1"
  kind: "PersistentVolumeClaim"
  metadata:
    name: "jenkins-home-workshop-demo-0"
    namespace: "cloudbees-sda"
  spec:
    accessModes:
    - "ReadWriteMany"
    resources:
      requests:
        storage: "50Gi"
    storageClassName: "ssd-cloudbees-ci-cloudbees-sda"
service:
  apiVersion: "v1"
  kind: "Service"
  metadata:
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    ports:
    - name: "http"
      port: 80
      protocol: "TCP"
      targetPort: 8080
    - name: "agent"
      port: 50023
      protocol: "TCP"
      targetPort: 50000
    selector:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
ingress:
  apiVersion: "networking.k8s.io/v1"
  kind: "Ingress"
  metadata:
    annotations:
      nginx.ingress.kubernetes.io/affinity: "cookie"
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
      nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/affinity-mode: "persistent"
      meta.helm.sh/release-name: "cloudbees-ci"
      meta.helm.sh/release-namespace: "cloudbees-sda"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      kubectl.kubernetes.io/last-applied-configuration: "{\"apiVersion\":\"networking.k8s.io/v1\"\
        ,\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"cert-manager.io/cluster-issuer\"\
        :\"letsencrypt-prod\",\"kubernetes.io/tls-acme\":\"false\",\"nginx.ingress.kubernetes.io/app-root\"\
        :\"/cjoc/teams-check/\",\"nginx.ingress.kubernetes.io/proxy-body-size\":\"\
        50m\",\"nginx.ingress.kubernetes.io/proxy-request-buffering\":\"off\",\"nginx.ingress.kubernetes.io/ssl-redirect\"\
        :\"true\"},\"labels\":{\"app.kubernetes.io/instance\":\"cloudbees-ci\",\"\
        app.kubernetes.io/managed-by\":\"Helm\",\"app.kubernetes.io/name\":\"cloudbees-core\"\
        ,\"helm.sh/chart\":\"cloudbees-core-3.11627_2e5eff15bf01\"},\"name\":\"cjoc\"\
        ,\"namespace\":\"cloudbees-sda\"},\"spec\":{\"ingressClassName\":\"nginx\"\
        ,\"rules\":[{\"host\":\"sda.preview.cb-demos.io\",\"http\":{\"paths\":[{\"\
        backend\":{\"service\":{\"name\":\"cjoc\",\"port\":{\"number\":80}}},\"path\"\
        :\"/cjoc\",\"pathType\":\"Prefix\"}]}}],\"tls\":[{\"hosts\":[\"sda.preview.cb-demos.io\"\
        ],\"secretName\":\"sda-tls\"}]}}\n"
      nginx.ingress.kubernetes.io/app-root: "/cjoc/teams-check/"
      kubernetes.io/tls-acme: "false"
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    ingressClassName: "nginx"
    rules:
    - host: "sda.preview.cb-demos.io"
      http:
        paths:
        - backend:
            service:
              name: "workshop-demo"
              port:
                name: "http"
          path: "/workshop-demo/"
          pathType: "Prefix"
additionalResources:
- apiVersion: "policy/v1"
  kind: "PodDisruptionBudget"
  metadata:
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    minAvailable: 1
    selector:
      matchLabels:
        com.cloudbees.cje.tenant: "workshop-demo"
        com.cloudbees.cje.type: "master"
        com.cloudbees.pse.tenant: "workshop-demo"
        com.cloudbees.pse.type: "master"
        tenant: "workshop-demo"
        type: "master"
allResources:
- apiVersion: "apps/v1"
  kind: "Deployment"
  metadata:
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    replicas: 2
    revisionHistoryLimit: 0
    selector:
      matchLabels:
        com.cloudbees.cje.tenant: "workshop-demo"
        com.cloudbees.cje.type: "master"
        com.cloudbees.pse.tenant: "workshop-demo"
        com.cloudbees.pse.type: "master"
        tenant: "workshop-demo"
        type: "master"
    template:
      metadata:
        labels:
          com.cloudbees.cje.tenant: "workshop-demo"
          com.cloudbees.cje.type: "master"
          com.cloudbees.pse.tenant: "workshop-demo"
          com.cloudbees.pse.type: "master"
          tenant: "workshop-demo"
          type: "master"
        name: "workshop-demo"
        namespace: "cloudbees-sda"
      spec:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: "kubernetes.io/os"
                  operator: "In"
                  values:
                  - "linux"
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.type"
                    operator: "In"
                    values:
                    - "cjoc"
                topologyKey: "kubernetes.io/hostname"
              weight: 1
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "jenkins"
                    operator: "In"
                    values:
                    - "slave"
                topologyKey: "kubernetes.io/hostname"
              weight: 1
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.tenant"
                    operator: "In"
                    values:
                    - "workshop-demo"
                topologyKey: "kubernetes.io/hostname"
              weight: 10
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: "com.cloudbees.cje.tenant"
                    operator: "In"
                    values:
                    - "workshop-demo"
                topologyKey: "topology.kubernetes.io/zone"
              weight: 10
        containers:
        - env:
          - name: "ENVIRONMENT"
            value: "KUBERNETES"
          - name: "JAVA_OPTS"
            value: "-Djenkins.model.Jenkins.slaveAgentPort=\"50000\" -Dhudson.TcpSlaveAgentListener.port=\"\
              50023\" -DexecutableWar.jetty.disableCustomSessionIdCookieName=\"true\"\
              \ -Dhudson.lifecycle=\"com.cloudbees.jenkins.plugins.replication.oc.RolloutLifecycle\"\
              \ -DMASTER_NAME=\"workshop-demo\" -Djenkins.model.Jenkins.slaveAgentPortEnforce=\"\
              true\" -DMASTER_GRANT_ID=\"2f3ca34a-abd8-4cba-a3e8-363a6b1aae86\" -Dhazelcast.config=\"\
              /usr/share/hazelcast/member.xml\" -DMASTER_DOMAIN=\"workshop-demo\" -Dcb.IMProp.warProfiles=\"\
              replication.json\" -DMASTER_INDEX=\"22\" -DMASTER_OPERATIONSCENTER_ENDPOINT=\"\
              http://cjoc.cloudbees-sda.svc.cluster.local/cjoc/\" -Dcom.cloudbees.jenkins.replication.warhead.ReplicationServletListener.enabled=\"\
              true\" -DMASTER_ENDPOINT=\"https://sda.preview.cb-demos.io/workshop-demo/\"\
              \ -DMASTER_WEBSOCKET=\"true\" -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=\"\
              true\" --add-modules java.se --add-exports java.base/jdk.internal.ref=ALL-UNNAMED\
              \ --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/sun.nio.ch=ALL-UNNAMED\
              \ --add-opens java.management/sun.management=ALL-UNNAMED --add-opens\
              \ jdk.management/com.sun.management.internal=ALL-UNNAMED -DMASTER_RESOURCE_URL=\
              \ -XshowSettings:vm -XX:+AlwaysPreTouch -XX:+DisableExplicitGC -XX:+ParallelRefProcEnabled\
              \ -XX:+UseStringDeduplication -Dhudson.slaves.NodeProvisioner.initialDelay=0\
              \ -Dorg.csanchez.jenkins.plugins.kubernetes.pipeline.PodTemplateStepExecution.defaultImage=cloudbees/cloudbees-core-agent:2.440.2.1\
              \ -Dcom.cloudbees.jenkins.plugins.kube.ServiceAccountFilter.defaultServiceAccount=jenkins-agents\
              \ -Dcom.cloudbees.networking.useSubdomain=false -Dcom.cloudbees.networking.protocol=\"\
              https\" -Dcom.cloudbees.networking.hostname=\"sda.preview.cb-demos.io\"\
              \ -Dcom.cloudbees.networking.port=443 -Dcom.cloudbees.networking.operationsCenterName=\"\
              cjoc\" -Dcom.sun.management.jmxremote.port=1099 -Dcom.sun.management.jmxremote.authenticate=false\
              \ -Dcom.sun.management.jmxremote.ssl=false"
          - name: "JENKINS_OPTS"
            value: "--prefix=/workshop-demo/"
          - name: "KUBERNETES_JENKINS_URL"
            value: "http://workshop-demo.cloudbees-sda.svc.cluster.local/workshop-demo/"
          image: "cloudbees/cloudbees-core-mm:2.440.3.8"
          livenessProbe:
            httpGet:
              path: "/workshop-demo/whoAmI/api/json?tree=authenticated"
              port: 8080
            initialDelaySeconds: 300
            periodSeconds: 10
            timeoutSeconds: 10
          name: "jenkins"
          ports:
          - containerPort: 8080
            name: "http"
          - containerPort: 50000
            name: "jnlp"
          - containerPort: 5701
            name: "hazelcast"
          readinessProbe:
            failureThreshold: 100
            httpGet:
              path: "/workshop-demo/whoAmI/api/json?tree=authenticated"
              port: 8080
            initialDelaySeconds: 30
            timeoutSeconds: 5
          resources:
            limits:
              cpu: "1.000000"
              memory: "3072.000000M"
          volumeMounts:
          - mountPath: "/tmp"
            name: "tmp"
          - mountPath: "/var/jenkins_home"
            name: "jenkins-home"
        enableServiceLinks: false
        securityContext:
          fsGroup: 1000
        serviceAccountName: "jenkins"
        terminationGracePeriodSeconds: 1200
        volumes:
        - emptyDir: {}
          name: "tmp"
        - name: "jenkins-home"
          persistentVolumeClaim:
            claimName: "jenkins-home-workshop-demo-0"
- apiVersion: "v1"
  kind: "PersistentVolumeClaim"
  metadata:
    name: "jenkins-home-workshop-demo-0"
    namespace: "cloudbees-sda"
  spec:
    accessModes:
    - "ReadWriteMany"
    resources:
      requests:
        storage: "50Gi"
    storageClassName: "ssd-cloudbees-ci-cloudbees-sda"
- apiVersion: "v1"
  kind: "Service"
  metadata:
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    ports:
    - name: "http"
      port: 80
      protocol: "TCP"
      targetPort: 8080
    - name: "agent"
      port: 50023
      protocol: "TCP"
      targetPort: 50000
    selector:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
- apiVersion: "networking.k8s.io/v1"
  kind: "Ingress"
  metadata:
    annotations:
      nginx.ingress.kubernetes.io/affinity: "cookie"
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
      nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/affinity-mode: "persistent"
      meta.helm.sh/release-name: "cloudbees-ci"
      meta.helm.sh/release-namespace: "cloudbees-sda"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      kubectl.kubernetes.io/last-applied-configuration: "{\"apiVersion\":\"networking.k8s.io/v1\"\
        ,\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"cert-manager.io/cluster-issuer\"\
        :\"letsencrypt-prod\",\"kubernetes.io/tls-acme\":\"false\",\"nginx.ingress.kubernetes.io/app-root\"\
        :\"/cjoc/teams-check/\",\"nginx.ingress.kubernetes.io/proxy-body-size\":\"\
        50m\",\"nginx.ingress.kubernetes.io/proxy-request-buffering\":\"off\",\"nginx.ingress.kubernetes.io/ssl-redirect\"\
        :\"true\"},\"labels\":{\"app.kubernetes.io/instance\":\"cloudbees-ci\",\"\
        app.kubernetes.io/managed-by\":\"Helm\",\"app.kubernetes.io/name\":\"cloudbees-core\"\
        ,\"helm.sh/chart\":\"cloudbees-core-3.11627_2e5eff15bf01\"},\"name\":\"cjoc\"\
        ,\"namespace\":\"cloudbees-sda\"},\"spec\":{\"ingressClassName\":\"nginx\"\
        ,\"rules\":[{\"host\":\"sda.preview.cb-demos.io\",\"http\":{\"paths\":[{\"\
        backend\":{\"service\":{\"name\":\"cjoc\",\"port\":{\"number\":80}}},\"path\"\
        :\"/cjoc\",\"pathType\":\"Prefix\"}]}}],\"tls\":[{\"hosts\":[\"sda.preview.cb-demos.io\"\
        ],\"secretName\":\"sda-tls\"}]}}\n"
      nginx.ingress.kubernetes.io/app-root: "/cjoc/teams-check/"
      kubernetes.io/tls-acme: "false"
    labels:
      com.cloudbees.cje.tenant: "workshop-demo"
      com.cloudbees.cje.type: "master"
      com.cloudbees.pse.tenant: "workshop-demo"
      com.cloudbees.pse.type: "master"
      tenant: "workshop-demo"
      type: "master"
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    ingressClassName: "nginx"
    rules:
    - host: "sda.preview.cb-demos.io"
      http:
        paths:
        - backend:
            service:
              name: "workshop-demo"
              port:
                name: "http"
          path: "/workshop-demo/"
          pathType: "Prefix"
- apiVersion: "policy/v1"
  kind: "PodDisruptionBudget"
  metadata:
    name: "workshop-demo"
    namespace: "cloudbees-sda"
  spec:
    minAvailable: 1
    selector:
      matchLabels:
        com.cloudbees.cje.tenant: "workshop-demo"
        com.cloudbees.cje.type: "master"
        com.cloudbees.pse.tenant: "workshop-demo"
        com.cloudbees.pse.type: "master"
        tenant: "workshop-demo"
        type: "master"
rawExtensions: []
